<!DOCTYPE HTML>
<html>

<head>
    <title>오늘의 할인, 오하린</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
</head>

<body class="is-preload">

    <!-- Wrapper -->
    <div id="wrapper">

        <!-- Main -->
        <div id="main">
            <div class="inner">

                <!-- Header -->
                <header id="header">
                    <a href="nearByStore.html" class="logo"><strong>오늘은 9월 16일</strong></a>
                </header>

                <!-- Login -->
                <section id="login">
                    <div class="login-box">
                        <img src="image/투명로고.png" alt="" style="width: 20%; height: auto;" />
                        <h2>회원 탈퇴</h2>
                        <div class="input-box">
                            <input type="tel" placeholder="Phone Number" required>
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                                fill="rgb(140, 140, 140)">
                                <path
                                    d="M234-276q51-39 114-61.5T480-360q69 0 132 22.5T726-276q35-41 54.5-93T800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 59 19.5 111t54.5 93Zm246-164q-59 0-99.5-40.5T340-580q0-59 40.5-99.5T480-720q59 0 99.5 40.5T620-580q0 59-40.5 99.5T480-440Zm0 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q53 0 100-15.5t86-44.5q-39-29-86-44.5T480-280q-53 0-100 15.5T294-220q39 29 86 44.5T480-160Zm0-360q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm0-60Zm0 360Z" />
                            </svg>
                        </div>
                        <div class="input-box">
                            <input type="password" placeholder="Password" required>
                            <svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px"
                                fill="rgb(140, 140, 140)">
                                <path
                                    d="M240-80q-33 0-56.5-23.5T160-160v-400q0-33 23.5-56.5T240-640h40v-80q0-83 58.5-141.5T480-920q83 0 141.5 58.5T680-720v80h40q33 0 56.5 23.5T800-560v400q0 33-23.5 56.5T720-80H240Zm0-80h480v-400H240v400Zm240-120q33 0 56.5-23.5T560-360q0-33-23.5-56.5T480-440q-33 0-56.5 23.5T400-360q0 33 23.5 56.5T480-280ZM360-640h240v-80q0-50-35-85t-85-35q-50 0-85 35t-35 85v80ZM240-160v-400 400Z" />
                            </svg>
                        </div>

                        <button type="submit" class="button" id="loginButton">회원 탈퇴</button>
                    </div>
                </section>
            </div>
        </div>

        <!-- Sidebar -->
        <div id="sidebar">
            <div class="inner">
                <!-- Logo -->
                <section style="text-align: center;">
                    <span>
                        <img src="image/가로로고.png" alt="" style="width: 70%; height: auto;" />
                    </span>
                </section>

                <!-- Menu -->
                <nav id="menu">
                    <header class="major">
                        <h2>Menu</h2>
                    </header>
                    <ul>
                        <li style="text-align: center;">
                            <a href="nearByStore.html">
                                <svg xmlns="http://www.w3.org/2000/svg" height="60px" viewBox="0 -960 960 960"
                                    width="60px" fill="rgb(106, 106, 106)">
                                    <path
                                        d="M240-200h120v-240h240v240h120v-360L480-740 240-560v360Zm-80 80v-480l320-240 320 240v480H520v-240h-80v240H160Zm320-350Z" />
                                </svg>
                                <h3 style="color:rgb(78, 78, 78);">홈</h3>
                            </a>
                        </li>
                        <li style="text-align: center;">
                            <a href="like.html">
                                <svg xmlns="http://www.w3.org/2000/svg" height="60px" viewBox="0 -960 960 960"
                                    width="60px" fill="rgb(106, 106, 106)">
                                    <path
                                        d="m480-120-58-52q-101-91-167-157T150-447.5Q111-500 95.5-544T80-634q0-94 63-157t157-63q52 0 99 22t81 62q34-40 81-62t99-22q94 0 157 63t63 157q0 46-15.5 90T810-447.5Q771-395 705-329T538-172l-58 52Zm0-108q96-86 158-147.5t98-107q36-45.5 50-81t14-70.5q0-60-40-100t-100-40q-47 0-87 26.5T518-680h-76q-15-41-55-67.5T300-774q-60 0-100 40t-40 100q0 35 14 70.5t50 81q36 45.5 98 107T480-228Zm0-273Z" />
                                </svg>
                                <h3 style="color:rgb(78, 78, 78);">찜</h3>
                            </a>
                        </li>
                        <li style="text-align: center;">
                            <a href="mypage.html">
                                <svg xmlns="http://www.w3.org/2000/svg" height="60px" viewBox="0 -960 960 960"
                                    width="60px" fill="rgb(106, 106, 106)">
                                    <path
                                        d="M620-520q25 0 42.5-17.5T680-580q0-25-17.5-42.5T620-640q-25 0-42.5 17.5T560-580q0 25 17.5 42.5T620-520Zm-280 0q25 0 42.5-17.5T400-580q0-25-17.5-42.5T340-640q-25 0-42.5 17.5T280-580q0 25 17.5 42.5T340-520Zm140 260q68 0 123.5-38.5T684-400h-66q-22 37-58.5 58.5T480-320q-43 0-79.5-21.5T342-400h-66q25 63 80.5 101.5T480-260Zm0 180q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-400Zm0 320q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Z" />
                                </svg>
                                <h3 style="color:rgb(78, 78, 78);">마이페이지</h3>
                            </a>
                        </li>
                    </ul>
                </nav>

                <!-- Footer -->
                <footer id="footer">
                    <p class="copyright">&copy; Untitled. All rights reserved. Demo Images: <a
                            href="https://unsplash.com">Unsplash</a>. Design: <a href="https://html5up.net">HTML5
                            UP</a>.</p>
                </footer>

            </div>
        </div>

    </div>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>
    <!-- 토큰 확인 및 요청 처리 -->
    <script>
        document.addEventListener('DOMContentLoaded', async function () {
            const token = localStorage.getItem('token');  // 저장된 토큰 불러오기

            if (token) {
                try {
                    const response = await fetch('http://localhost:3000/api/protected', {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${token}`,  // 토큰을 Authorization 헤더에 추가
                        },
                    });

                    if (response.ok) {
                        const data = await response.json();
                        console.log('데이터:', data);  // 데이터 처리
                    } else {
                        console.log(token);
                        alert('인증 실패');
                        window.location.href = 'login.html';  // 인증 실패 시 로그인 페이지로 리다이렉트
                    }
                } catch (error) {
                    console.error('에러 발생', error);
                }
            } else {
                alert('로그인이 필요합니다');
                window.location.href = 'login.html';  // 토큰이 없으면 로그인 페이지로 리다이렉션
            }
        });

        // 페이지가 로드될 때 토큰 확인
        window.onload = function () {
            const token = localStorage.getItem('token');

            if (!token || token === "undefined") {
                alert('로그인이 필요합니다.');
                window.location.href = 'login.html';  // 토큰이 없으면 로그인 페이지로 이동
            }
        };
    </script>
    <script>
        // 사용자 삭제 이벤트
        document.getElementById('loginButton').addEventListener('click', async function (event) {
            event.preventDefault();  // 기본 동작을 막음

            const phoneNumber = document.querySelector('input[type="tel"]').value;
            const password = document.querySelector('input[type="password"]').value;
            const token = localStorage.getItem('token');  // 로그인할 때 저장된 JWT 토큰

            if (!token) {
                alert('로그인이 필요합니다.');
                window.location.href = 'login.html';
                return;
            }

            try {
                // 삭제 API로 토큰 전송
                const deleteResponse = await fetch(`http://localhost:3000/api/delete?phoneNumber=${encodeURIComponent(phoneNumber)}&password=${encodeURIComponent(password)}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });


                if (deleteResponse.ok) {
                    alert('회원 탈퇴가 완료되었습니다.');
                    localStorage.removeItem('token');  // 토큰 삭제
                    window.location.href = 'index.html';  // 홈 화면으로 이동
                } else {
                    alert('회원 탈퇴에 실패했습니다.');
                }

            } catch (error) {
                console.error('에러 발생', error);
                alert('서버에 문제가 발생했습니다.');
            }
        });

    </script>
</body>

</html>