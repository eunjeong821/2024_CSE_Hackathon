<!DOCTYPE HTML>
<html>
<head>
    <title>오늘의 할인, 오하린</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
</head>
<body class="is-preload">

    <!-- Wrapper -->
    <div id="wrapper">

        <!-- Main -->
        <div id="main">
            <div class="inner">

                <!-- Header -->
                <header id="header">
                    <a href="nearByStore.html" class="logo"><strong>오늘은 9월 16일</strong></a>
                </header>

                <!-- 내 정보 수정 -->
                <section class="changeInfo-container">
                    <div class="content" style="position: relative; left:3%;">
                        <header class="mypage-name">
                            <svg xmlns="http://www.w3.org/2000/svg" height="60px" viewBox="0 -960 960 960" width="60px" fill="#3d4449">
                                <path d="M234-276q51-39 114-61.5T480-360q69 0 132 22.5T726-276q35-41 54.5-93T800-480q0-133-93.5-226.5T480-800q-133 0-226.5 93.5T160-480q0 59 19.5 111t54.5 93Zm246-164q-59 0-99.5-40.5T340-580q0-59 40.5-99.5T480-720q59 0 99.5 40.5T620-580q0 59-40.5 99.5T480-440Zm0 360q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q53 0 100-15.5t86-44.5q-39-29-86-44.5T480-280q-53 0-100 15.5T294-220q39 29 86 44.5T480-160Zm0-360q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm0-60Zm0 360Z"/>
                            </svg>
                            <h1 id="user-name">홍길동님</h1>
                            <button type="button" class="button" onclick="location.href='deleteAccount.html'" id="deleteButton">회원탈퇴</button>
                        </header>
                        <hr class="dividing-line">

                        <div class="changeInfo-item">
                            <label for="change-name" style="margin-right: 10px;">* 내 이름</label>
                            <input type="text" id="change-name" placeholder="이름 불러오는 중..." style="height:50px;">
                        </div>

                        <div class="changeInfo-item">
                            <label for="change-password" style="margin-right: 10px;">* 비밀번호</label>
                            <input type="password" id="change-password" placeholder="비밀번호 불러오는 중..." style="height:50px;">
                        </div>

                        <div class="changeInfo-item">
                            <label for="change-tel" style="margin-right: 10px;">* 전화번호</label>
                            <input type="text" id="change-tel" placeholder="전화번호 불러오는 중..." style="height:50px;">
                            <button type="submit" onclick="location.href='telCheckOTP.html'" style="border: solid 1px gray; border-radius: 0; box-shadow: none; color: gray !important; height: 30px; width: 50px; line-height: 0; padding: 10px 10px 10px 10px; font-size: 10px; position: relative; bottom: 40px; left: 87%;">확인</button>
                        </div>

                        <div class="rightButton" style="position: relative; right: 3.5%;">
                            <button type="submit">저장하기</button>
                        </div>
                        <hr class="dividing-line">
                    </div>
                </section>
            </div>
        </div>

        <!-- Sidebar -->
        <div id="sidebar">
            <!-- Sidebar content omitted for brevity -->
        </div>

    </div>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
        // 페이지가 로드될 때 사용자 정보 불러오기
        document.addEventListener('DOMContentLoaded', async function () {
            const token = localStorage.getItem('token');  // 저장된 토큰 불러오기

            if (token) {
                try {
                    const response = await fetch('http://localhost:3000/api/mypage', {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${token}`,  // 토큰을 Authorization 헤더에 추가
                        },
                    });

                    if (response.ok) {
                        const userData = await response.json();
                        // 받아온 데이터를 입력 필드에 반영
                        document.getElementById('change-name').value = userData.nickname;
                        document.getElementById('change-password').value = userData.password;
                        document.getElementById('change-tel').value = userData.phoneNumber;
                        document.getElementById('user-name').textContent = `${userData.nickname}님`;
                    } else {
                        alert('사용자 정보를 불러오지 못했습니다.');
                        window.location.href = 'login.html';  // 인증 실패 시 로그인 페이지로 리다이렉트
                    }
                } catch (error) {
                    console.error('에러 발생', error);
                    alert('서버 오류가 발생했습니다.');
                }
            } else {
                alert('로그인이 필요합니다');
                window.location.href = 'login.html';  // 토큰이 없으면 로그인 페이지로 리다이렉션
            }
        });
    </script>
</body>
</html>
